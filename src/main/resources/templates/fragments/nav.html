<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>
<header th:fragment="nav"
        xmlns:th="http://www.thymeleaf.org"
        xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
        class="sticky top-0 z-40 border-b border-blue-900/60 bg-blue-950/90 backdrop-blur">
    <div class="mx-auto max-w-5xl px-4 text-slate-100">

        <div class="flex h-16 items-center justify-between">
            <!-- Brand -->
            <a th:href="@{/}" class="flex items-center gap-2 font-semibold tracking-tight text-2xl">
                <img th:src="@{/img/petcare.png}" alt="" class="h-10 w-10" />
                <span>PetCare</span>
            </a>

            <!-- Mobile menu button -->
            <button id="nav-toggle"
                    type="button"
                    class="md:hidden inline-flex items-center justify-center rounded-lg border border-blue-800/70 px-3 py-2 text-sm text-slate-100 hover:bg-blue-900/50 focus:outline-none focus:ring-2 focus:ring-blue-400"
                    aria-controls="nav-menu" aria-expanded="false">
                <span class="sr-only">Open main menu</span>
                <svg class="h-5 w-5" viewBox="0 0 24 24" stroke="currentColor"
                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <line x1="3" y1="6" x2="21" y2="6" />
                    <line x1="3" y1="12" x2="21" y2="12" />
                    <line x1="3" y1="18" x2="21" y2="18" />
                </svg>
            </button>

            <!-- Desktop actions -->
            <nav class="hidden md:flex items-center gap-6">
                <!-- Left: main links -->
                <div class="flex items-center gap-4">
                    <a th:href="@{/}"
                       class="text-sm hover:text-blue-300 transition"
                       th:classappend="${currentPath == '/'
                                        ? ' text-white font-medium'
                                        : ' text-slate-300'}">
                        Home
                    </a>

                    <a th:href="@{/status}"
                       class="text-sm hover:text-blue-300 transition"
                       th:classappend="${#strings.startsWith(currentPath, '/status')
                                        ? ' text-white font-medium'
                                        : ' text-slate-300'}">
                        System Status
                    </a>

                    <!-- Logged-in: extra navigation -->
                    <a th:href="@{/pets}"
                       sec:authorize="isAuthenticated()"
                       class="text-sm hover:text-blue-300 transition"
                       th:classappend="${#strings.startsWith(currentPath, '/pets')
                                        ? ' text-white font-medium'
                                        : ' text-slate-300'}">
                        My Pets
                    </a>

                    <a th:href="@{/vet}"
                       sec:authorize="hasAnyRole('VET','ADMIN')"
                       class="text-sm hover:text-blue-300 transition"
                       th:classappend="${#strings.startsWith(currentPath, '/vet')
                                        ? ' text-white font-medium'
                                        : ' text-slate-300'}">
                        Vet Panel
                    </a>

                    <a th:href="@{/admin}"
                       sec:authorize="hasRole('ADMIN')"
                       class="text-sm hover:text-blue-300 transition"
                       th:classappend="${#strings.startsWith(currentPath, '/admin')
                                        ? ' text-white font-medium'
                                        : ' text-slate-300'}">
                        Admin
                    </a>
                </div>

                <!-- Right: auth controls -->
                <!-- Guest -->
                <span sec:authorize="!isAuthenticated()" class="flex items-center gap-3">
                    <a th:href="@{/auth/login}"
                       class="text-sm hover:text-blue-300 transition"
                       th:classappend="${#strings.startsWith(currentPath, '/auth/login')
                                            ? ' text-white font-medium underline decoration-blue-400 decoration-2 underline-offset-4'
                                            : ' text-slate-300'}">
                        Login
                    </a>
                    <a th:href="@{/auth/register}"
                       class="text-sm rounded-lg text-white px-3 py-1.5 hover:bg-blue-500 transition shadow-sm"
                       th:classappend="${#strings.startsWith(currentPath, '/auth/register')
                                            ? ' bg-blue-500 ring-2 ring-blue-300'
                                            : ' bg-blue-600'}">
                        Register
                    </a>
                </span>
                <!-- Logged-in -->
                <span sec:authorize="isAuthenticated()" class="flex items-center gap-3">
                    <span class="text-sm text-slate-200">
                        Hello, <strong sec:authentication="name"></strong>
                    </span>
                    <form th:action="@{/auth/logout}" method="post" class="m-0">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <button type="submit"
                                class="text-sm rounded-lg border border-blue-800/70 px-3 py-1.5 hover:bg-blue-900/50 transition">
                            Sign Out
                        </button>
                    </form>
                </span>
            </nav>
        </div>

        <!-- Mobile menu (collapsible) -->
        <nav id="nav-menu" class="md:hidden hidden pb-4">
            <div class="flex flex-col gap-2 pt-2">
                <a th:href="@{/}"
                   class="rounded-lg px-3 py-2 text-sm hover:bg-blue-900/40 transition"
                   th:classappend="${currentPath == '/'
                                    ? ' bg-blue-900/60 text-white'
                                    : ' text-slate-200'}">
                    Home
                </a>

                <a th:href="@{/status}"
                   class="rounded-lg px-3 py-2 text-sm hover:bg-blue-900/40 transition"
                   th:classappend="${#strings.startsWith(currentPath, '/status')
                                    ? ' bg-blue-900/60 text-white'
                                    : ' text-slate-200'}">
                    System Status
                </a>

                <!-- Logged-in links (mobile) -->
                <a th:href="@{/pets}"
                   sec:authorize="isAuthenticated()"
                   class="rounded-lg px-3 py-2 text-sm hover:bg-blue-900/40 transition"
                   th:classappend="${#strings.startsWith(currentPath, '/pets')
                                    ? ' bg-blue-900/60 text-white'
                                    : ' text-slate-200'}">
                    My Pets
                </a>

                <a th:href="@{/vet}"
                   sec:authorize="hasAnyRole('VET','ADMIN')"
                   class="rounded-lg px-3 py-2 text-sm hover:bg-blue-900/40 transition"
                   th:classappend="${#strings.startsWith(currentPath, '/vet')
                                    ? ' bg-blue-900/60 text-white'
                                    : ' text-slate-200'}">
                    Vet Panel
                </a>

                <a th:href="@{/admin}"
                   sec:authorize="hasRole('ADMIN')"
                   class="rounded-lg px-3 py-2 text-sm hover:bg-blue-900/40 transition"
                   th:classappend="${#strings.startsWith(currentPath, '/admin')
                                    ? ' bg-blue-900/60 text-white'
                                    : ' text-slate-200'}">
                    Admin
                </a>

                <!-- Guest (mobile) -->
                <div sec:authorize="!isAuthenticated()" class="mt-1 flex items-center gap-2">
                    <a th:href="@{/auth/login}"
                       class="flex-1 rounded-lg px-3 py-2 text-center text-sm transition"
                       th:classappend="${#strings.startsWith(currentPath, '/auth/login')
                                            ? ' bg-blue-900/60 text-white border border-blue-700'
                                            : ' text-slate-100 border border-blue-800/70 hover:bg-blue-900/40'}">
                        Login
                    </a>
                    <a th:href="@{/auth/register}"
                       class="flex-1 rounded-lg px-3 py-2 text-center text-sm transition shadow-sm"
                       th:classappend="${#strings.startsWith(currentPath, '/auth/register')
                                            ? ' bg-blue-500 text-white ring-2 ring-blue-300'
                                            : ' bg-blue-600 text-white hover:bg-blue-500'}">
                        Register
                    </a>
                </div>

                <!-- Logged-in (mobile) -->
                <div sec:authorize="isAuthenticated()" class="mt-2 flex items-center justify-between gap-2">
                    <span class="px-1 text-sm text-slate-200">
                        Hello, <strong sec:authentication="name"></strong>
                    </span>
                    <form th:action="@{/auth/logout}" method="post" class="m-0">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <button type="submit"
                                class="rounded-lg border border-blue-800/70 px-3 py-2 text-sm hover:bg-blue-900/40 transition">
                            Logout
                        </button>
                    </form>
                </div>
            </div>
        </nav>
    </div>

    <script>
        (function () {
            const btn = document.getElementById('nav-toggle');
            const menu = document.getElementById('nav-menu');
            if (!btn || !menu) return;
            btn.addEventListener('click', () => {
                const nowHidden = menu.classList.toggle('hidden');
                btn.setAttribute('aria-expanded', String(!nowHidden));
            });
        })();
    </script>
</header>
</body>
</html>
